Test Case SpecificationIntelligent Audit Trail SystemCoverage Matrix|| ID | Title | Type | Priority | Edge Case || TC-01 | User Creation Audit | Functional | P0 | No || TC-02 | Update with Diff Logging | Functional | P0 | No || TC-03 | Optimistic Locking Conflict | Concurrency | P0 | Yes || TC-04 | Soft Delete Logic | Functional | P0 | No || TC-05 | Rollback to Previous Version | Logic | P0 | Yes || TC-06 | Middleware User Tracking | Security | P1 | No || TC-07 | Invalid Rollback Target | Validation | P1 | Yes || TC-08 | Soft Delete Exclusion | Logic | P1 | Yes |Coverage: 8 test cases | Functional: 3 | Logic: 2 | Concurrency: 1 | Security: 1 | Validation: 1Test CasesTC-01: User Creation Audit| Field | Value || Type | Functional || Purpose | Verify user creation automatically creates an audit log. || Input | POST /api/users/    {"email": "test@test.com", "name": "Test", "role": "USER", "department": "IT"} || Expected | 1. API returns 201 Created.    2. User table has record with version=1.    3. AuditLog table has entry with action="CREATE" and object_id=<new_id>. || Status Code | 201 || Validates | Signal post_save creation logic. |TC-02: Update with Diff Logging| Field | Value || Type | Functional || Purpose | Verify updates calculate JSON diffs correctly. || Input | PUT /api/users/{id}/    {"name": "New Name", "version": 1} || State | Original Name: "Old Name". Current Version: 1. || Expected | 1. API returns 200 OK.    2. User version increments to 2.    3. AuditLog entry created with diff={"name": {"old": "Old Name", "new": "New Name"}}. || Status Code | 200 || Validates | pre_save (fetching old data) and post_save (diff calculation). |TC-03: Optimistic Locking Conflict| Field | Value || Type | Concurrency || Purpose | Verify updates fail if the client provides a stale version. || Input | PUT /api/users/{id}/    {"name": "Hacker", "version": 1} || State | Current DB Version: 2 (Someone else already updated it). || Expected | API returns error {"error": "Version conflict"}. Update is NOT applied. || Status Code | 409 || Validates | Concurrency control and data integrity. |TC-04: Soft Delete Logic| Field | Value || Type | Functional || Purpose | Verify DELETE does not remove row, but sets flag. || Input | DELETE /api/users/{id}/ || Expected | 1. API returns 204 No Content.    2. Row exists in DB but is_deleted=True.    3. AuditLog entry created with action="DELETE". || Status Code | 204 || Validates | Soft delete implementation and signal triggering on delete. |TC-05: Rollback to Previous Version| Field | Value || Type | Logic || Purpose | Verify system can revert data state. || Input | POST /api/users/{id}/rollback/    {"target_version": 1} || State | Current Version: 3. Target Version: 1 (Original state). || Expected | 1. User data reverts to Version 1 values.    2. User version becomes 4 (history moves forward).    3. AuditLog entry created with action="ROLLBACK". || Status Code | 200 || Validates | Complex logic: Traversing audit logs to restore state. |TC-06: Middleware User Tracking| Field | Value || Type | Security || Purpose | Verify the system tracks WHO made the change via Middleware. || Input | PUT /api/users/{id}/ (Authenticated as "admin_user") || Expected | The created AuditLog entry has changed_by="admin_user". || Status Code | 200 || Validates | Thread-local storage implementation in Middleware + Signal access. |TC-07: Invalid Rollback Target| Field | Value || Type | Validation || Purpose | Verify rollback rejects non-existent versions. || Input | POST /api/users/{id}/rollback/    {"target_version": 99} || State | Max Version is 3. || Expected | {"error": "Target version not found"} || Status Code | 400 || Validates | Rollback integrity checks. |TC-08: Soft Delete Exclusion| Field | Value || Type | Logic || Purpose | Verify AuditedManager excludes deleted rows from standard queries. || Input | GET /api/users/ || State | User A (Active), User B (Soft Deleted). || Expected | Response list includes User A, but excludes User B. || Status Code | 200 || Validates | Custom Manager implementation (objects.all() filter). |Scoring Rubric| Category | Points | Criteria || Core Audit Logic | 30 | TC-01, TC-02, TC-04 pass. Signals work correctly. || System Architecture | 25 | Middleware correctly handles thread-local user storage (TC-06). || Concurrency | 20 | TC-03 passes (Optimistic Locking). || Complex Logic | 15 | TC-05 passes (Rollback implementation). || Code Quality | 10 | Clean separation of Signals, Models, and Views. |Total: 100 points Pass Criteria: â‰¥ 70 points (Must pass TC-03 and TC-06)
